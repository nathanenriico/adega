<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adega do Tio Pancho - Bebidas Premium e Combos Especiais</title>
    <meta name="description" content="Adega do Tio Pancho - As melhores bebidas, vinhos premium e combos especiais. Atendimento via WhatsApp. Seu rol√™ come√ßa aqui!">
    <meta name="keywords" content="adega, bebidas, vinho, cerveja, whisky, combos, delivery, whatsapp">
    <meta name="author" content="Adega do Tio Pancho">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Adega do Tio Pancho - Bebidas Premium">
    <meta property="og:description" content="As melhores bebidas, vinhos premium e combos especiais. Atendimento via WhatsApp.">
    <meta property="og:image" content="https://images.unsplash.com/photo-1506377247377-2a5b3b417ebb?w=1200&h=630">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Adega do Tio Pancho - Bebidas Premium">
    <meta property="twitter:description" content="As melhores bebidas, vinhos premium e combos especiais. Atendimento via WhatsApp.">
    <meta property="twitter:image" content="https://images.unsplash.com/photo-1506377247377-2a5b3b417ebb?w=1200&h=630">
    
    <!-- PWA -->
    <meta name="theme-color" content="#d4af37">
    <link rel="apple-touch-icon" href="https://images.unsplash.com/photo-1506377247377-2a5b3b417ebb?w=180&h=180">
    
    <!-- Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://images.unsplash.com">
    
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/banner.css">
    <link rel="stylesheet" href="css/pix-payment.css">
    <link rel="stylesheet" href="css/mobile-app.css">
    <link rel="stylesheet" href="css/mobile-cards.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-init.js"></script>
    <script src="js/config.js"></script>
    <script src="js/pontos-system.js"></script>
    <script src="js/init-cupons.js"></script>
    <script src="js/test-cupons.js"></script>
    <script src="js/update-points-display.js"></script>
    <script src="js/pontos-realtime.js"></script>
    <script src="js/navigation-fix-final.js"></script>
    <script src="js/script.js"></script>
    <script src="js/products-final.js"></script>
</head>
<body>
    <!-- Menu Superior Fixo -->
    <nav class="top-nav">
        <div class="nav-container">
            <button class="menu-toggle-top" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <div class="nav-items">
                <div class="nav-item" onclick="goToHome()">
                    <div class="nav-icon">üè†</div>
                    <span>In√≠cio</span>
                </div>
                <div class="nav-item" onclick="showSection('products')">
                    <div class="nav-icon">üç∑</div>
                    <span>Produtos</span>
                </div>
                <div class="nav-item" onclick="showSection('about')">
                    <div class="nav-icon">‚ÑπÔ∏è</div>
                    <span>Sobre</span>
                </div>
                <div class="nav-item" onclick="showSection('contact')">
                    <div class="nav-icon">üìû</div>
                    <span>Contato</span>
                </div>
            </div>
            
            <div class="nav-right">
                <!-- Perfil do Cliente -->
                <div id="account-menu" class="account-menu" onclick="toggleAccountMenu()">
                    <div class="account-icon">üë§</div>
                    <div class="account-info">
                        <span class="account-greeting">Ol√°, <span id="account-name">Teste</span></span>
                        <span class="account-subtitle">Conta e pedidos</span>
                    </div>
                </div>
                
                <!-- Widget do Carrinho -->
                <div class="cart-widget" onclick="toggleCart()">
                    <div class="cart-icon">üõí</div>
                    <div class="cart-info">
                        <div class="cart-count" id="cart-count-widget">0 itens</div>
                        <div class="cart-total" id="cart-total-widget">R$ 0,00</div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <h1>üç∑ Adega do Tio Pancho</h1>
            </div>
            <p class="slogan">Seu rol√™ come√ßa aqui üçª</p>
        </header>

        <!-- Navigation -->
        <nav class="main-nav">
            <ul class="nav-menu">
                <li><a href="javascript:void(0)" onclick="goToHome()">In√≠cio</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('products')">Produtos</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('about')">Sobre</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('contact')">Contato</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <!-- Home Section -->
            <div id="home" class="section active">
                <div class="home-section">
                    <!-- Sistema de Informa√ß√µes do Cliente -->
                    <div id="customer-info" class="customer-info-section" style="display: none;">
                        <div class="welcome-container">
                            <div class="welcome-header">
                                <h1>üçª Bem-vindo √† Adega do Tio Pancho!</h1>
                                <p>Para garantir uma entrega r√°pida e personalizada, precisamos de alguns dados:</p>
                            </div>

                            <form id="welcome-form" class="welcome-form">
                                <div class="form-section">
                                    <h3>‚úçÔ∏è Dados Pessoais</h3>
                                    
                                    <div class="form-field">
                                        <label for="nome">Nome Completo *</label>
                                        <input type="text" id="nome" name="nome" required>
                                    </div>

                                    <div class="form-field">
                                        <label for="whatsapp">WhatsApp com DDD *</label>
                                        <input type="tel" id="whatsapp" name="whatsapp" placeholder="(11) 99999-9999" required>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h3>üì¶ Endere√ßo de Entrega</h3>
                                    
                                    <div class="form-field">
                                        <label for="cep">CEP *</label>
                                        <input type="text" id="cep" name="cep" placeholder="12950-660" maxlength="9" required>
                                    </div>

                                    <div class="form-field">
                                        <label for="rua">Rua (Logradouro) *</label>
                                        <input type="text" id="rua" name="rua" placeholder="Rua das Margaridas" required>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-field">
                                            <label for="numero">N√∫mero *</label>
                                            <input type="text" id="numero" name="numero" placeholder="375" required>
                                        </div>
                                        <div class="form-field">
                                            <label for="complemento">Complemento</label>
                                            <input type="text" id="complemento" name="complemento" placeholder="Casa">
                                        </div>
                                    </div>

                                    <div class="form-field">
                                        <label for="bairro">Bairro *</label>
                                        <input type="text" id="bairro" name="bairro" placeholder="Nova Atiaba" required>
                                    </div>

                                    <div class="form-field">
                                        <label for="cidade">Cidade *</label>
                                        <input type="text" id="cidade" name="cidade" value="Atibaia" required>
                                    </div>
                                </div>

                                <button type="submit" class="submit-btn">Continuar para a Adega üç∑</button>
                            </form>

                            <div id="loading" class="loading" style="display: none;">
                                <p>Salvando seus dados...</p>
                            </div>

                            <div id="error-message" class="error-message" style="display: none;"></div>
                        </div>
                    </div>
                    
                    <!-- Banner Principal -->
                    <div class="hero-banner">
                        <div class="banner-content">
                            <h2>üç∑ Bebidas Premium com Entrega R√°pida</h2>
                            <p>As melhores cervejas, vinhos e destilados da regi√£o</p>
                            <div class="banner-actions">
                                <button onclick="showSection('products')" class="banner-btn primary">
                                    Ver Produtos üõí
                                </button>
                                <button onclick="openWhatsApp()" class="banner-btn secondary">
                                    WhatsApp üí¨
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Informa√ß√µes de Contato -->
                    <div class="contact-card">
                        <h2>üìû Contato Direto</h2>
                        <p><strong>(11) 93394-9002</strong></p>
                        <p>Atendimento r√°pido e personalizado</p>
                        <button onclick="openWhatsApp()" class="whatsapp-btn">
                            Chamar no WhatsApp üí¨
                        </button>
                    </div>
                    
                    <!-- Hor√°rios de Funcionamento -->
                    <div class="hours-card">
                        <h2>üïí Hor√°rios de Funcionamento</h2>
                        <div class="hours-grid">
                            <div class="day">
                                <span>Domingo</span>
                                <span>09:00 - 18:00</span>
                            </div>
                            <div class="day">
                                <span>Segunda</span>
                                <span>09:00 - 17:00</span>
                            </div>
                            <div class="day">
                                <span>Ter√ßa - Quinta</span>
                                <span>10:00 - 20:00</span>
                            </div>
                            <div class="day">
                                <span>Sexta - S√°bado</span>
                                <span>10:00 - 22:00</span>
                            </div>
                        </div>
                        <div class="delivery-hours">
                            <h3>üöö Entregas: 10:00 - 20:00</h3>
                        </div>
                    </div>
                    
                    <!-- Avalia√ß√µes dos Clientes -->
                    <div class="reviews-card">
                        <h2>‚≠ê O que nossos clientes dizem</h2>
                        <div class="reviews-list">
                            <div class="review">
                                <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                                <p>"Excelente atendimento e produtos de qualidade! Entrega super r√°pida."</p>
                                <span class="reviewer">- Maria Silva</span>
                            </div>
                            <div class="review">
                                <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                                <p>"Melhor adega da regi√£o! Pre√ßos justos e variedade incr√≠vel."</p>
                                <span class="reviewer">- Jo√£o Santos</span>
                            </div>
                            <div class="review">
                                <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                                <p>"Atendimento via WhatsApp √© muito pr√°tico. Recomendo!"</p>
                                <span class="reviewer">- Ana Costa</span>
                            </div>
                        </div>
                    </div>
                    

                </div>
            </div>

            <!-- Products Section -->
            <div id="products" class="section">
                <div class="products-section">
                    <h3>üçª Nossos Produtos</h3>
                    
                    <!-- Filters -->
                    <div class="filters category-grid">
                        <div class="category-item" onclick="filterProducts('all')">
                            <div class="category-icon">üõí</div>
                            <span class="category-name">Todos</span>
                        </div>
                        <div class="category-item" onclick="filterProducts('cervejas')">
                            <div class="category-icon">üç∫</div>
                            <span class="category-name">Cervejas</span>
                        </div>
                        <div class="category-item" onclick="filterProducts('vinhos')">
                            <div class="category-icon">üç∑</div>
                            <span class="category-name">Vinhos</span>
                        </div>
                        <div class="category-item" onclick="filterProducts('destilados')">
                            <div class="category-icon">ü•É</div>
                            <span class="category-name">Destilados</span>
                        </div>
                        <div class="category-item" onclick="filterProducts('churrasco')">
                            <div class="category-icon">ü•©</div>
                            <span class="category-name">Churrasco</span>
                        </div>
                        <div class="category-item" onclick="filterProducts('chopp')">
                            <div class="category-icon">üçª</div>
                            <span class="category-name">Chopp</span>
                        </div>
                        <div class="category-item" onclick="filterProducts('aguas')">
                            <div class="category-icon">üíß</div>
                            <span class="category-name">√Åguas e Gelo</span>
                        </div>
                        <div class="category-item" onclick="filterProducts('drinks')">
                            <div class="category-icon">ü•§</div>
                            <span class="category-name">Drinks Prontos</span>
                        </div>
                        <div class="category-item" onclick="filterProducts('petiscos')">
                            <div class="category-icon">üçø</div>
                            <span class="category-name">Petiscos</span>
                        </div>
                        <div class="category-item" onclick="filterProducts('sobremesas')">
                            <div class="category-icon">üç∞</div>
                            <span class="category-name">Sobremesas</span>
                        </div>
                        <div class="category-item" onclick="filterProducts('mercearia')">
                            <div class="category-icon">üõçÔ∏è</div>
                            <span class="category-name">Mercearia</span>
                        </div>
                        <div class="category-item" onclick="filterProducts('conveniencia')">
                            <div class="category-icon">üè™</div>
                            <span class="category-name">Conveni√™ncia</span>
                        </div>
                    </div>
                    
                    <!-- Products Grid -->
                    <div class="products-grid" id="products-grid">
                        <!-- Products will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- About Section -->
            <div id="about" class="section">
                <div class="about-section">
                    <h3>üç∑ Sobre a Adega do Tio Pancho</h3>
                    <p>Especializada em bebidas premium, oferecemos os melhores vinhos, cervejas artesanais e destilados com atendimento personalizado.</p>
                    
                    <div class="features">
                        <div class="feature">
                            <h4>üç∑ Produtos Premium</h4>
                            <p>Sele√ß√£o cuidadosa de bebidas de alta qualidade</p>
                        </div>
                        <div class="feature">
                            <h4>üöö Entrega R√°pida</h4>
                            <p>Atendimento √°gil via WhatsApp</p>
                        </div>
                        <div class="feature">
                            <h4>üí∞ Melhores Pre√ßos</h4>
                            <p>Ofertas especiais e promo√ß√µes exclusivas</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Section -->
            <div id="contact" class="section">
                <div class="contact-section">
                    <div class="welcome-section">
                        <h2>üìû Entre em Contato</h2>
                        <p><strong>(11) 93394-9002</strong></p>
                        <p>Atendimento direto e r√°pido via WhatsApp</p>
                        <button onclick="openWhatsApp()" class="whatsapp-btn">
                            Chamar no WhatsApp üí¨
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Admin Access -->
        <div class="admin-access">
            <button id="admin-btn">Admin</button>
        </div>
    </div>
    
    <!-- Modal Admin Login -->
    <div id="admin-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAdminModal()">&times;</span>
            <h3>üîê Acesso Administrativo</h3>
            <input type="password" id="admin-password" placeholder="Senha do administrador">
            <button onclick="adminLogin()">Entrar</button>
        </div>
    </div>
    
    <!-- Painel Admin -->
    <div id="admin-panel" class="admin-panel hidden">
        <div class="admin-header">
            <h3>‚öôÔ∏è Painel Administrativo</h3>
            <div class="admin-header-buttons">
                <button onclick="goToHome()" class="back-to-site-btn">üè† Voltar ao Site</button>
                <button onclick="logout()">üö™ Sair</button>
            </div>
        </div>
        
        <div class="admin-sections">
            <!-- Configura√ß√µes Gerais -->
            <div class="admin-section" style="display: none;">
                <h4>üè™ Configura√ß√µes da Adega</h4>
                <input type="text" id="adega-name" placeholder="Nome da Adega">
                <input type="tel" id="whatsapp-number" placeholder="N√∫mero WhatsApp (apenas n√∫meros)">
                <textarea id="default-message" placeholder="Mensagem padr√£o do WhatsApp"></textarea>
                <input type="url" id="payment-link" placeholder="Link de pagamento (opcional)">
                <button onclick="saveSettings()">üíæ Salvar Configura√ß√µes</button>
            </div>
            
            <!-- Gerenciamento de Produtos -->
            <div class="admin-section" id="add-product-section" style="display: none;">
                <div class="estoque-header">
                    <h4>üì¶ Adicionar Produto</h4>
                    <div class="estoque-actions">
                        <button onclick="hideAddProductSection()" class="filter-btn">‚Üê Voltar</button>
                    </div>
                </div>
                
                <div class="estoque-table-container">
                    <div class="product-form-grid">
                        <div class="form-group">
                            <label>Nome do Produto</label>
                            <input type="text" id="product-name" placeholder="Digite o nome do produto">
                        </div>
                        
                        <div class="form-group">
                            <label>Pre√ßo</label>
                            <input type="number" id="product-price" placeholder="0.00" step="0.01" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label>Categoria</label>
                            <select id="product-category">
                                <option value="cervejas">Cervejas</option>
                                <option value="vinhos">Vinhos</option>
                                <option value="drinks">Drinks</option>
                                <option value="refrigerantes">Refrigerantes</option>
                                <option value="aguas">√Åguas e Gelo</option>
                                <option value="chopp">Chopp</option>
                            </select>
                        </div>
                        
                        <div class="form-group full-width">
                            <label>Imagem do Produto</label>
                            <div class="image-upload-section">
                                <label for="product-image-file" class="image-upload-label">
                                    üì∑ Selecionar Imagens
                                </label>
                                <input type="file" id="product-image-file" accept="image/*" multiple onchange="previewImage(this)">
                                <input type="url" id="product-image-url" placeholder="Ou cole URL da imagem">
                                <div id="image-preview" class="image-preview"></div>
                            </div>
                        </div>
                        
                        <div class="form-actions full-width">
                            <button onclick="addProduct()" class="new-btn">‚ûï Adicionar Produto</button>
                            <button onclick="clearProductForm()" class="filter-btn">üóëÔ∏è Limpar</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Painel de Estoque -->
            <div class="admin-section" id="estoque-section">
                <div class="estoque-header">
                    <h4>üì¶ Estoque</h4>
                    <div class="estoque-actions">
                        <input type="text" id="search-products" placeholder="Pesquisar..." class="search-input">
                        <button onclick="filterProducts('all')" class="filter-btn">Filtrar</button>
                        <button onclick="showAddProductSection()" class="new-btn">+ Novo</button>
                    </div>
                </div>
                
                <div class="estoque-table-container">
                    <table class="estoque-table">
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Componente</th>
                                <th>Estoque</th>
                                <th>Editar</th>
                                <th>Deletar</th>
                            </tr>
                        </thead>
                        <tbody id="estoque-tbody">
                            <!-- Produtos ser√£o carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Analytics -->
            <div class="admin-section">
                <h4>üìä Analytics</h4>
                <div class="analytics-grid">
                    <div class="metric-card">
                        <h5>Cliques WhatsApp</h5>
                        <span id="whatsapp-clicks">0</span>
                    </div>
                    <div class="metric-card">
                        <h5>Visitantes Hoje</h5>
                        <span id="daily-visitors">0</span>
                    </div>
                    <div class="metric-card">
                        <h5>Produtos Populares</h5>
                        <div id="popular-products">-</div>
                    </div>
                </div>
                <button onclick="resetAnalytics()">üóëÔ∏è Resetar Dados</button>
            </div>
            
            <!-- Gest√£o Avan√ßada -->
            <div class="admin-section">
                <h4>üöÄ Gest√£o Avan√ßada</h4>
                <div class="management-buttons">
                    <button onclick="openOrdersManagement()" class="management-btn">
                        üìã Gest√£o de Pedidos
                    </button>
                    <button onclick="openCartAnalytics()" class="management-btn analytics-btn">
                        üìä Analytics do Carrinho
                    </button>
                    <button onclick="openRemovedProductsAnalytics()" class="management-btn analytics-btn">
                        üóëÔ∏è Produtos Exclu√≠dos
                    </button>
                </div>
            </div>
            
            <!-- Banco de Dados -->
            <div class="admin-section">
                <h4>üíæ Status do Banco de Dados</h4>
                <div class="db-status-card">
                    <p id="db-status">Verificando conex√£o...</p>
                    <small>√öltima verifica√ß√£o: <span id="last-check">-</span></small>
                </div>
                <div class="db-actions">
                    <button onclick="syncProductsToSupabase()" class="sync-btn">
                        üîÑ Sincronizar Produtos
                    </button>
                    <button onclick="updateDatabaseStatus()" class="status-btn">
                        üì° Verificar Status
                    </button>
                    <button onclick="testOrderSave()" class="test-btn">
                        üß™ Testar Pedido
                    </button>
                </div>
            </div>
            

        </div>
    </div>

    <!-- Menu Lateral -->
    <div id="side-menu" class="side-menu">
        <div class="menu-header">
            <h3>Menu</h3>
            <button class="menu-close" onclick="toggleMenu()">&times;</button>
        </div>
        <div class="menu-content">
            <div class="menu-item" onclick="toggleCart()">
                <div class="menu-icon">üõí</div>
                <div class="menu-text">
                    <span>Carrinho</span>
                    <span class="cart-badge" id="cart-count">0</span>
                </div>
            </div>
            <div class="menu-item" onclick="toggleChatBot()">
                <div class="menu-icon">ü§ñ</div>
                <div class="menu-text">Chat</div>
            </div>
            <div class="menu-item" onclick="openWhatsApp()">
                <div class="menu-icon">üí¨</div>
                <div class="menu-text">WhatsApp</div>
            </div>
        </div>
    </div>
    <div id="menu-overlay" class="menu-overlay" onclick="toggleMenu()"></div>
    
    <!-- Carrinho Lateral -->
    <div id="cart-sidebar" class="cart-sidebar">
        <div class="cart-header">
            <h3>Meu Carrinho</h3>
            <button class="cart-close" onclick="toggleCart()">&times;</button>
        </div>
        <div class="cart-content">
            <div id="cart-items"></div>
            

        </div>
    </div>
    <div id="cart-overlay" class="cart-overlay" onclick="toggleCart()"></div>

    <!-- Dropdown Menu da Conta -->
    <div id="account-dropdown" class="account-dropdown">
        <div class="account-dropdown-content">
            <div class="account-header">
                <div class="account-avatar">üë§</div>
                <div class="account-welcome">
                    <h3>Ol√°, <span id="dropdown-name">Teste</span>! üëã</h3>
                    <p>Bem-vindo de volta √† Adega do Tio Pancho</p>
                </div>
            </div>
            
            <div class="account-details">
                <div class="detail-item">
                    <div class="detail-icon">üë§</div>
                    <div class="detail-content">
                        <span class="detail-label">Nome Completo</span>
                        <span class="detail-value" id="dropdown-full-name">Teste</span>
                    </div>
                </div>
                <div class="detail-item">
                    <div class="detail-icon">üì±</div>
                    <div class="detail-content">
                        <span class="detail-label">WhatsApp</span>
                        <span class="detail-value" id="dropdown-whatsapp">11941716615</span>
                    </div>
                </div>

            </div>
            

            
            <div class="account-actions">
                <button onclick="makeNewOrder()" class="action-btn new-order">
                    üõí Fazer Novo Pedido
                </button>
                <button onclick="showOrderHistory()" class="action-btn history">
                    üìã Meus Pedidos
                </button>

                <button onclick="logoutCustomer()" class="action-btn logout">
                    üö™ Sair da Conta
                </button>
            </div>

        </div>
    </div>
    <div id="account-overlay" class="account-overlay" onclick="toggleAccountMenu()"></div>

    <!-- Bot√£o Flutuante do Chat -->
    <div id="chat-float-btn" class="chat-float-btn" onclick="toggleChatBot()">
        ü§ñ
    </div>
    
    <!-- Chat Bot -->
    <div id="chatbot-container" class="chatbot-container">
        <div class="chatbot-header">
            <span>ü§ñ Assistente Virtual</span>
            <button onclick="toggleChatBot()">&times;</button>
        </div>
        <div class="chatbot-messages" id="chatbot-messages">
            <div class="bot-message">
                Ol√°! Sou o assistente da Adega do Tio Pancho. Como posso ajudar?
            </div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatbot-input" placeholder="Digite sua mensagem..." onkeypress="handleChatInput(event)">
            <button id="send-btn" onclick="sendChatMessage()">‚û§</button>
        </div>
        <div class="chatbot-footer">
            <small>Assistente Virtual - Adega do Tio Pancho</small>
        </div>
    </div>
    
    <!-- Menu Inferior Mobile -->
    <div class="mobile-bottom-nav">
        <div class="mobile-nav-item" onclick="goToHome()">
            <div class="mobile-nav-icon">üè†</div>
            <span>In√≠cio</span>
        </div>
        <div class="mobile-nav-item" onclick="showSection('products')">
            <div class="mobile-nav-icon">üç∑</div>
            <span>Produtos</span>
        </div>
        <div class="mobile-nav-item" onclick="toggleCart()">
            <div class="mobile-nav-icon">üõí</div>
            <span>Carrinho</span>
        </div>
        <div class="mobile-nav-item" onclick="toggleChatBot()">
            <div class="mobile-nav-icon">ü§ñ</div>
            <span>Chat</span>
        </div>
        <div class="mobile-nav-item" onclick="openWhatsApp()">
            <div class="mobile-nav-icon">üí¨</div>
            <span>WhatsApp</span>
        </div>
    </div>
    
    <!-- Scripts -->
    <script>
        // Fun√ß√£o para salvar informa√ß√µes do cliente
        async function saveCustomerInfo(event) {
            if (event) event.preventDefault();
            
            const name = document.getElementById('nome').value.trim();
            const whatsapp = document.getElementById('whatsapp').value.trim();
            const cep = document.getElementById('cep').value.trim();
            const rua = document.getElementById('rua').value.trim();
            const numero = document.getElementById('numero').value.trim();
            const complemento = document.getElementById('complemento').value.trim();
            const bairro = document.getElementById('bairro').value.trim();
            const cidade = document.getElementById('cidade').value.trim();
            
            // Mostrar loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error-message').style.display = 'none';
            
            // Validar campos obrigat√≥rios
            if (!name || !whatsapp || !cep || !rua || !numero || !bairro || !cidade) {
                alert('Por favor, preencha todos os campos obrigat√≥rios!');
                return;
            }
            
            // Validar WhatsApp
            const whatsappRegex = /^\(?\d{2}\)?[\s-]?9?\d{4}[\s-]?\d{4}$/;
            if (!whatsappRegex.test(whatsapp)) {
                alert('Por favor, insira um n√∫mero de WhatsApp v√°lido!');
                return;
            }
            
            try {
                // Criar cliente Supabase
                const client = window.supabase.createClient(
                    'https://vtrgtorablofhmhizrjr.supabase.co',
                    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0cmd0b3JhYmxvZmhtaGl6cmpyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MzI3OTQ3NSwiZXhwIjoyMDY4ODU1NDc1fQ.lq8BJEn9HVeyQl6SUCdVXgxdWsveDS07kQUhktko8B4'
                );
                
                // Verificar se cliente j√° existe
                const { data: existingClient } = await client
                    .from('clientes')
                    .select('id, nome')
                    .eq('whatsapp', whatsapp)
                    .single();
                
                let data;
                
                if (existingClient) {
                    data = existingClient;
                } else {
                    // Criar novo cliente
                    const { data: newClient, error } = await client
                        .from('clientes')
                        .insert({
                            nome: name,
                            whatsapp: whatsapp,
                            cep: cep,
                            rua: rua,
                            numero: numero,
                            complemento: complemento || null,
                            bairro: bairro,
                            cidade: cidade,
                            pontos: 0
                        })
                        .select()
                        .single();
                    
                    if (error) {
                        console.error('Erro ao salvar no Supabase:', error);
                        alert('Erro ao salvar: ' + (error.message || 'WhatsApp j√° cadastrado'));
                        return;
                    }
                    
                    data = newClient;
                }
                
                // Salvar localmente
                const userData = { 
                    nome: name, 
                    whatsapp: whatsapp,
                    endereco: `${rua}, ${numero}${complemento ? ', ' + complemento : ''}, ${bairro}, ${cidade} - ${cep}`
                };
                localStorage.setItem('userData', JSON.stringify(userData));
                localStorage.setItem('userRegistered', 'true');
                
                if (data && data.id) {
                    localStorage.setItem('userId', data.id);
                }
                
                // Esconder loading
                document.getElementById('loading').style.display = 'none';
                
                // Esconder formul√°rio e mostrar sistema de pontua√ß√£o
                document.getElementById('customer-info').style.display = 'none';
                document.getElementById('logged-customer-panel').style.display = 'block';
                
                // Atualizar dados no painel
                document.getElementById('logged-customer-name').textContent = name.split(' ')[0];
                document.getElementById('customer-full-name').textContent = name;
                document.getElementById('customer-whatsapp').textContent = whatsapp;
                document.getElementById('customer-points-display').textContent = '0 pontos';
                
                // Mostrar mensagem de sucesso
                const successMsg = document.createElement('div');
                successMsg.className = 'success-message';
                successMsg.innerHTML = `
                    <h3>‚úÖ Cadastro realizado!</h3>
                    <p>Bem-vindo √† Adega do Tio Pancho, ${name.split(' ')[0]}!</p>
                `;
                document.body.appendChild(successMsg);
                
                setTimeout(() => successMsg.remove(), 3000);
                
            } catch (error) {
                console.error('Erro no cadastro:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error-message').style.display = 'block';
                document.getElementById('error-message').textContent = 'Erro ao salvar dados. Tente novamente.';
            }
        }
        
        // Adicionar event listener ao formul√°rio
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('welcome-form');
            if (form) {
                form.addEventListener('submit', saveCustomerInfo);
            }
        });
        
        // Tornar fun√ß√£o global
        window.saveCustomerInfo = saveCustomerInfo;
        
        // Fun√ß√£o para atualizar status do banco
        async function updateDatabaseStatus() {
            const statusEl = document.getElementById('db-status');
            const lastCheckEl = document.getElementById('last-check');
            
            if (!statusEl) return;
            
            statusEl.textContent = 'Verificando...';
            
            try {
                const { data, error } = await supabase.from('products').select('count').limit(1);
                
                if (error) {
                    statusEl.textContent = '‚ùå Erro de conex√£o';
                    statusEl.style.color = '#dc3545';
                } else {
                    statusEl.textContent = '‚úÖ Conectado';
                    statusEl.style.color = '#25d366';
                }
            } catch (error) {
                statusEl.textContent = '‚ùå Falha na conex√£o';
                statusEl.style.color = '#dc3545';
            }
            
            if (lastCheckEl) {
                lastCheckEl.textContent = new Date().toLocaleTimeString('pt-BR');
            }
        }
        
        // Fun√ß√£o para sincronizar produtos
        async function syncProductsToSupabase() {
            try {
                console.log('üîÑ Iniciando sincroniza√ß√£o...');
                await syncAllProductsToSupabase();
                alert('Produtos sincronizados com sucesso!');
                updateDatabaseStatus();
            } catch (error) {
                console.error('Erro na sincroniza√ß√£o:', error);
                alert('Erro na sincroniza√ß√£o: ' + error.message);
            }
        }
        
        // Tornar fun√ß√µes globais
        window.updateDatabaseStatus = updateDatabaseStatus;
        window.syncProductsToSupabase = syncProductsToSupabase;
        
        // Fun√ß√£o para carregar produtos do Supabase
        function loadSupabaseProducts() {
            const grid = document.getElementById('products-grid');
            if (!grid) return;
            
            grid.innerHTML = '<p style="text-align: center; color: #fff; padding: 40px;">Carregando produtos...</p>';
            
            // Usar inst√¢ncia global do Supabase
            if (!window.supabase) {
                grid.innerHTML = '<p style="text-align: center; color: #ff6b6b; padding: 40px;">Supabase n√£o dispon√≠vel</p>';
                return;
            }
            
            const client = window.supabase.createClient(
                'https://vtrgtorablofhmhizrjr.supabase.co',
                'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0cmd0b3JhYmxvZmhtaGl6cmpyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MzI3OTQ3NSwiZXhwIjoyMDY4ODU1NDc1fQ.lq8BJEn9HVeyQl6SUCdVXgxdWsveDS07kQUhktko8B4'
            );
            
            client.from('products').select('*').eq('active', true).order('created_at', { ascending: false }).then(result => {
                const { data, error } = result;
                
                if (error) {
                    grid.innerHTML = `<p style="text-align: center; color: #ff6b6b; padding: 40px;">Erro: ${error.message}</p>`;
                    return;
                }
                
                if (!data || data.length === 0) {
                    grid.innerHTML = '<p style="text-align: center; color: #fff; padding: 40px;">Nenhum produto encontrado</p>';
                    return;
                }
                
                // Renderizar produtos
                const html = data.map(product => `
                    <div class="product-card modern-card">
                        <div class="product-image-container">
                            <img src="${product.image || 'https://via.placeholder.com/150x150/f0f0f0/999?text=Produto'}" 
                                 alt="${product.name}" class="product-image" 
                                 onerror="this.src='https://via.placeholder.com/150x150/f0f0f0/999?text=Produto'">
                            <button class="add-btn" onclick="addToCart(${product.id})" title="Adicionar ao carrinho">
                                +
                            </button>
                        </div>
                        <div class="product-info">
                            <div class="product-price">R$ ${parseFloat(product.price).toFixed(2).replace('.', ',')}</div>
                            <div class="product-name">${product.name}</div>
                        </div>
                    </div>
                `).join('');
                
                grid.innerHTML = html;
                console.log(`‚úÖ ${data.length} produtos carregados`);
            }).catch(err => {
                grid.innerHTML = `<p style="text-align: center; color: #ff6b6b; padding: 40px;">Erro: ${err.message}</p>`;
            });
        }
        
        // Tornar fun√ß√£o global
        window.loadSupabaseProducts = loadSupabaseProducts;
        
        // Fun√ß√£o vazia para evitar erro
        function loadDeliveryAddress() {
            // Fun√ß√£o vazia - implementar se necess√°rio
        }
        
        // Carregar endere√ßo salvo ao inicializar
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (typeof loadDeliveryAddress === 'function') {
                    loadDeliveryAddress();
                }
            }, 1000);
        });
    </script>
    
    <script>
        // Inicializar produtos globalmente
        window.products = [];
        
        // Aguardar e carregar produtos
        function waitForSupabaseAndLoadProducts() {
            if (window.supabase) {
                console.log('üöÄ Carregando produtos...');
                loadSupabaseProducts();
            } else {
                console.log('‚è≥ Aguardando Supabase...');
                setTimeout(waitForSupabaseAndLoadProducts, 1000);
            }
        }
        
        // Fun√ß√£o de teste
        function testSupabaseProducts() {
            if (!window.supabase) {
                console.error('‚ùå Supabase n√£o dispon√≠vel');
                return;
            }
            
            const client = window.supabase.createClient(
                'https://vtrgtorablofhmhizrjr.supabase.co',
                'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0cmd0b3JhYmxvZmhtaGl6cmpyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MzI3OTQ3NSwiZXhwIjoyMDY4ODU1NDc1fQ.lq8BJEn9HVeyQl6SUCdVXgxdWsveDS07kQUhktko8B4'
            );
            
            client.from('products').select('*').eq('active', true).limit(10).then(result => {
                const { data, error } = result;
                
                if (error) {
                    console.error('‚ùå Erro:', error);
                    return;
                }
                
                if (data && data.length > 0) {
                    console.log(`‚úÖ ${data.length} produtos encontrados`);
                    data.forEach(p => {
                        console.log(`- ${p.name}: R$ ${p.price} (${p.category})`);
                    });
                } else {
                    console.log('‚ö†Ô∏è Nenhum produto encontrado');
                }
            }).catch(err => {
                console.error('‚ùå Erro:', err);
            });
        }
        
        window.testSupabaseProducts = testSupabaseProducts;
        
        // Fun√ß√£o para recarregar produtos (alias para loadSupabaseProducts)
        function reloadProductsFromDatabase() {
            loadSupabaseProducts();
        }
        
        // Fun√ß√£o para filtrar produtos por categoria
        function filterProducts(category) {
            const grid = document.getElementById('products-grid');
            if (!grid) return;
            
            // Atualizar bot√µes ativos (tanto filter-btn quanto category-item)
            document.querySelectorAll('.filter-btn, .category-item').forEach(btn => btn.classList.remove('active'));
            
            // Encontrar e ativar o item clicado
            if (event && event.target) {
                const clickedElement = event.target.closest('.category-item') || event.target;
                clickedElement.classList.add('active');
            }
            
            if (!window.supabase) {
                grid.innerHTML = '<p style="text-align: center; color: #ff6b6b; padding: 40px;">Supabase n√£o dispon√≠vel</p>';
                return;
            }
            
            grid.innerHTML = '<p style="text-align: center; color: #fff; padding: 40px;">Carregando produtos...</p>';
            
            const client = window.supabase.createClient(
                'https://vtrgtorablofhmhizrjr.supabase.co',
                'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0cmd0b3JhYmxvZmhtaGl6cmpyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MzI3OTQ3NSwiZXhwIjoyMDY4ODU1NDc1fQ.lq8BJEn9HVeyQl6SUCdVXgxdWsveDS07kQUhktko8B4'
            );
            
            let query = client.from('products').select('*').eq('active', true);
            
            if (category !== 'all') {
                query = query.eq('category', category);
            }
            
            query.order('created_at', { ascending: false }).then(result => {
                const { data, error } = result;
                
                if (error) {
                    grid.innerHTML = `<p style="text-align: center; color: #ff6b6b; padding: 40px;">Erro: ${error.message}</p>`;
                    return;
                }
                
                if (!data || data.length === 0) {
                    grid.innerHTML = '<p style="text-align: center; color: #fff; padding: 40px;">Nenhum produto encontrado nesta categoria</p>';
                    return;
                }
                
                // Renderizar produtos filtrados
                const html = data.map(product => `
                    <div class="product-card modern-card">
                        <div class="product-image-container">
                            <img src="${product.image || 'https://via.placeholder.com/150x150/f0f0f0/999?text=Produto'}" 
                                 alt="${product.name}" class="product-image" 
                                 onerror="this.src='https://via.placeholder.com/150x150/f0f0f0/999?text=Produto'">
                            <button class="add-btn" onclick="addToCart(${product.id})" title="Adicionar ao carrinho">
                                +
                            </button>
                        </div>
                        <div class="product-info">
                            <div class="product-price">R$ ${parseFloat(product.price).toFixed(2).replace('.', ',')}</div>
                            <div class="product-name">${product.name}</div>
                        </div>
                    </div>
                `).join('');
                
                grid.innerHTML = html;
                console.log(`‚úÖ ${data.length} produtos da categoria '${category}' carregados`);
            }).catch(err => {
                grid.innerHTML = `<p style="text-align: center; color: #ff6b6b; padding: 40px;">Erro: ${err.message}</p>`;
            });
        }
        
        // Fun√ß√£o para toggle do menu da conta
        function toggleAccountMenu() {
            const dropdown = document.getElementById('account-dropdown');
            const overlay = document.getElementById('account-overlay');
            
            dropdown.classList.toggle('active');
            overlay.classList.toggle('active');
            
            // Carregar dados do usu√°rio
            if (dropdown.classList.contains('active')) {
                loadUserDataToDropdown();
            }
        }
        
        // Fun√ß√£o para carregar dados do usu√°rio no dropdown
        function loadUserDataToDropdown() {
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            const userPoints = localStorage.getItem('userPoints') || '10';
            
            if (userData.nome) {
                const firstName = userData.nome.split(' ')[0];
                document.getElementById('account-name').textContent = firstName;
                document.getElementById('dropdown-name').textContent = firstName;
                document.getElementById('dropdown-full-name').textContent = userData.nome;
            }
            
            if (userData.whatsapp) {
                document.getElementById('dropdown-whatsapp').textContent = userData.whatsapp;
            }
            
            document.getElementById('dropdown-points').textContent = userPoints + ' pontos';
        }
        
        // Tornar fun√ß√µes globais
        window.filterProducts = filterProducts;
        window.reloadProductsFromDatabase = reloadProductsFromDatabase;
        window.toggleAccountMenu = toggleAccountMenu;
        
        // Verificar se usu√°rio j√° est√° cadastrado
        function checkUserRegistration() {
            const userData = localStorage.getItem('userData');
            const userRegistered = localStorage.getItem('userRegistered');
            
            if (!userData || userRegistered !== 'true') {
                // Usu√°rio n√£o cadastrado, redirecionar para p√°gina de registro
                window.location.href = 'registro.html';
                return;
            }
            
            // Usu√°rio j√° cadastrado, esconder formul√°rio e mostrar painel
            const customerInfo = document.getElementById('customer-info');
            const customerPanel = document.getElementById('logged-customer-panel');
            
            if (customerInfo) customerInfo.style.display = 'none';
            if (customerPanel) customerPanel.style.display = 'block';
            
            // Carregar dados do usu√°rio
            const user = JSON.parse(userData);
            const loggedName = document.getElementById('logged-customer-name');
            const fullName = document.getElementById('customer-full-name');
            const whatsappEl = document.getElementById('customer-whatsapp');
            
            if (loggedName) loggedName.textContent = user.nome.split(' ')[0];
            if (fullName) fullName.textContent = user.nome;
            if (whatsappEl) whatsappEl.textContent = user.whatsapp;
            
            // Carregar pontos do usu√°rio
            const points = localStorage.getItem('userPoints') || '0';
            const pointsDisplay = document.getElementById('customer-points-display');
            if (pointsDisplay) pointsDisplay.textContent = points + ' pontos';
        }
        
        // Carregar produtos automaticamente
        document.addEventListener('DOMContentLoaded', function() {
            checkUserRegistration();
            waitForSupabaseAndLoadProducts();
            loadUserDataToDropdown();
        });
        window.addEventListener('load', waitForSupabaseAndLoadProducts);
    </script>
</body>
</html>