<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finalizar Pedido - Adega do Tio Pancho</title>
    <link rel="stylesheet" href="css/checkout.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/checkout-tabs.css">
    <link rel="stylesheet" href="css/pix-payment.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/pontos-system.js"></script>
    <script src="js/init-cupons.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <button class="back-btn" onclick="goBack()">‚Üê</button>
            <h1>Finalizar Pedido</h1>
        </header>

        <main class="checkout-content">
            <!-- Endere√ßo de Entrega -->
            <section class="delivery-address">
                <h2>üìç Endere√ßo de Entrega</h2>
                <div class="address-card">
                    <div class="address-info">
                        <p><strong>Endere√ßo n√£o cadastrado</strong></p>
                        <p>Clique em "Alterar" para cadastrar</p>
                    </div>
                    <button class="change-address-btn" onclick="changeAddress()">Alterar</button>
                </div>
            </section>

            <!-- Tempo e Taxa de Entrega -->
            <section class="delivery-info">
                <div class="delivery-time">
                    <h3>üïí Tempo de Entrega</h3>
                    <p class="time-estimate">45-55 minutos</p>
                </div>
                <div class="delivery-fee">
                    <h3>üöö Taxa de Entrega</h3>
                    <p class="fee-amount">R$ 8,90</p>
                </div>
            </section>

            <!-- Formas de Pagamento -->
            <section class="payment-methods">
                <h2>üí≥ Forma de Pagamento</h2>
                
                <div class="payment-tabs">
                    <button class="payment-tab active" onclick="showPaymentTab('online')">Pague Online</button>
                    <button class="payment-tab" onclick="showPaymentTab('delivery')">Pague na Entrega</button>
                </div>
                
                <div id="online-payment" class="payment-tab-content active">
                    <div class="payment-options">
                        <div class="payment-option">
                            <input type="radio" id="pix" name="payment" value="pix" checked>
                            <label for="pix">
                                <div class="payment-icon">üí∏</div>
                                <span>PIX</span>
                            </label>
                        </div>
                    </div>
                    <div class="pix-payment-container" id="pix-payment-container">
                        <div class="pix-box">
                            <h3>üí∏ Pague com PIX</h3>
                            <p>Ap√≥s clicar em "Fazer Pedido", voc√™ receber√° as instru√ß√µes de pagamento.</p>
                            
                            <div class="pix-info">
                                <p><strong>Chave PIX:</strong> 11941716617</p>
                                <p><strong>Benefici√°rio:</strong> ADEGA PANCHO</p>
                                <p><strong>Valor:</strong> <span id="pix-value">R$ 0,00</span></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="delivery-payment" class="payment-tab-content">
                    <div class="payment-options">
                        <div class="payment-option">
                            <input type="radio" id="money" name="payment" value="money">
                            <label for="money">
                                <div class="payment-icon">üí∞</div>
                                <span>Dinheiro</span>
                            </label>
                        </div>
                        <div class="payment-option">
                            <input type="radio" id="credit-card-delivery" name="payment" value="credit-card-delivery">
                            <label for="credit-card-delivery">
                                <div class="payment-icon">üí≥</div>
                                <span>Cart√£o de Cr√©dito</span>
                            </label>
                        </div>
                        <div class="payment-option">
                            <input type="radio" id="debit-card-delivery" name="payment" value="debit-card-delivery">
                            <label for="debit-card-delivery">
                                <div class="payment-icon">üí≥</div>
                                <span>Cart√£o de D√©bito</span>
                            </label>
                        </div>
                    </div>
                    <div class="change-info" id="change-info" style="display: none;">
                        <label for="change-amount">üí∞ Troco para quanto?</label>
                        <input type="number" id="change-amount" placeholder="Ex: 50.00" step="0.01" min="0">
                        <small>Deixe em branco se n√£o precisar de troco</small>
                    </div>
                </div>
            </section>

            <!-- Dados para Nota Fiscal e Contato -->
            <section class="tax-info">
                <h2>üìÑ Dados para Nota Fiscal e Contato</h2>
                <div class="tax-input">
                    <input type="text" id="cpf-cnpj" placeholder="CPF ou CNPJ (opcional)" maxlength="18">
                    <small>Para emiss√£o da nota fiscal</small>
                </div>
                <div class="email-input" style="margin-top: 15px;">
                    <input type="email" id="customer-email" placeholder="E-mail para confirma√ß√£o (opcional)">
                    <small>Para envio da confirma√ß√£o do pedido</small>
                </div>
            </section>

            <!-- Cupons de Desconto -->
            <section class="coupon-section">
                <h2>üéÅ Cupons de Desconto</h2>
                <div class="coupon-input">
                    <select id="coupon-select" onchange="applyCoupon()">
                        <option value="">Selecionar cupom</option>
                    </select>
                </div>
            </section>

            <!-- Resumo do Pedido -->
            <section class="order-summary">
                <h2>üìã Resumo do Pedido</h2>
                <div class="restaurant-info">
                    <h3>üç∑ Adega do Tio Pancho</h3>
                    <p>R. Oswaldo Barreto, 708 E - Alvin√≥polis</p>
                </div>
                
                <div class="order-items" id="order-items">
                    <!-- Itens do carrinho ser√£o carregados aqui -->
                </div>

                <div class="order-totals">
                    <div class="total-line">
                        <span>Subtotal</span>
                        <span id="subtotal">R$ 0,00</span>
                    </div>
                    <div class="total-line" id="discount" style="display: none; color: #25D366; background: rgba(37, 211, 102, 0.1); padding: 8px; border-radius: 5px; margin: 5px 0;">
                        <span style="font-weight: bold;">üí∞ Voc√™ est√° economizando</span>
                        <span style="font-weight: bold; font-size: 1.1em;">- R$ 0,00</span>
                    </div>
                    <div class="total-line">
                        <span>Taxa de entrega</span>
                        <span id="delivery-fee">R$ 8,90</span>
                    </div>
                    <div class="total-line final-total">
                        <span><strong>Total</strong></span>
                        <span id="total"><strong>R$ 8,90</strong></span>
                    </div>
                </div>
            </section>

            <!-- Bot√£o de Confirma√ß√£o -->
            <div class="checkout-actions">
                <button class="confirm-order-btn" id="confirm-btn" onclick="confirmOrder()">
                    Fazer Pedido - R$ 8,90
                </button>
            </div>
        </main>
    </div>

    <!-- Modal de Endere√ßo -->
    <div id="address-modal" class="modal">
        <div class="modal-content">
            <h3>Alterar Endere√ßo</h3>
            <input type="text" placeholder="CEP" id="cep-input">
            <input type="text" placeholder="Rua" id="street-input">
            <input type="text" placeholder="N√∫mero" id="number-input">
            <input type="text" placeholder="Bairro" id="neighborhood-input">
            <div class="modal-actions">
                <button onclick="closeModal()">Cancelar</button>
                <button onclick="saveAddress()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Cart√£o -->
    <div id="card-modal" class="modal">
        <div class="modal-content">
            <h3>Adicionar Cart√£o</h3>
            <input type="text" placeholder="N√∫mero do cart√£o" id="card-number">
            <input type="text" placeholder="Nome no cart√£o" id="card-name">
            <div class="card-row">
                <input type="text" placeholder="MM/AA" id="card-expiry">
                <input type="text" placeholder="CVV" id="card-cvv">
            </div>
            <div class="modal-actions">
                <button onclick="closeModal()">Cancelar</button>
                <button onclick="saveCard()">Adicionar</button>
            </div>
        </div>
    </div>

    <script src="js/checkout-functions.js"></script>
    <script src="js/checkout-updated.js"></script>
    <script src="js/debug-checkout.js"></script>
</body>
</html>